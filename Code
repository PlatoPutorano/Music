VERSION WITHOUT AI...........................................................................................




import aiogram
import random
import requests
from bs4 import BeautifulSoup
import pandas as pd
from aiogram import Bot, Dispatcher, executor, types
import logging
import os

bot = Bot(token = 'YOUR_BOT_TOKEN')
dp = Dispatcher(bot)
logging.basicConfig(level=logging.INFO)

global s
global g
global x
global text
text = ''
x = 0

@dp.message_handler(commands = ['start', 'help'])
async def welcome(message:types.Message):

    text = '\U0001F62D'
    await message.reply("Hi!\nDo you want to listen to music?\nThen you've come to the right place!!!\nSending music will take time. We'll have to wait.\nFor me to send you music, write a message like this:\n/music 'author of the composition' 'title of the song'.\nIf the bot sent the wrong song that you were looking for, then enter the /next command.\nI can also determine the name of the song from the lyrics.\nTo do this, you need to enter the command /text 'song lyrics'.\nIf this is not the song you were looking for, then enter the /next command.\nI was created by @PlatoPutorano")

@dp.message_handler(commands = ['music'])
async def music(message:types.Message):
    global text
    global g
    g = 0
    text = message.text
    text1 = ''
    i = 0
    while i < len(text) and text[i] != ' ':
        i += 1

    i += 1
    while i < len(text):
        text1 += text[i]
        i += 1
    i += 0
    url1 =  (text1)
    print(url1)
    url = ''
    i = 52
    while i < len(url1) and url1[i] != '"':
        url += url1[i]
        i += 1
    text = find_name(text1)
    text2 = find_avtor(text1)
    text2 = func(text2)
    text1 = ""
    text = func(text)
    i = 0
    for i in range(len(text)):
        if text[i] != ' ':
            text1 = text1 + text[i]
    text1 = text1 + " "
    i = 0
    for i in range(len(text2)):
        if text2[i] != ' ':
            text1 = text1 + text2[i]
    text1 = func(text1)
    print(text1)
    if i >= len(url1):
        await message.answer('Whoops..... The bot did not find the song.')
    else:
        g+=1
        await message.answer('The bot sends the song.')
        download_music(url=url,name=text1)
        await bot.send_audio(message.from_user.id, audio=open(text1, 'rb'))
        delete_music(text1)


@dp.message_handler(commands=['next'])
async def next_music(message:types.Message):
    global text
    global g
    text1 = ''
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    i = 0
    while i < len(text) and text[i] != ' ':
        i += 1

    i += 1
    while i < len(text):
        text1 += text[i]
        i += 1
    i += 0
    url1 = find_music(text1)
    print(url1)
    url = ''
    i = 52
    while i < len(url1) and url1[i] != '"':
        url += url1[i]
        i += 1
    print(url)
    text = find_name(text1)
    text1 = ""
    text = func(text)
    i = 0
    for i in range(len(text)):
        if text[i] != ' ':
            text1 = text1 + text[i]
    text1 = text1 + " "
    text2 = find_avtor(text1)
    text2 = func(text2)
    i = 0
    for i in range(len(text2)):
        if text2[i] != ' ':
            text1 = text1 + text2[i]
    text1 = func(text1)
    print(text1)
    if i >= len(url1):
        await message.answer('Whoops..... The bot did not find the song.')
    else:
        await message.answer('The bot sends the song.')
        download_music(url=url, name=text1)
        await bot.send_audio(message.from_user.id, audio=open(text1, 'rb'))
        delete_music(text1)

@dp.message_handler(commands=['text'])
async def grandfather(message:types.Message):
    global x
    global text
    x = 0
    text1 = message.text
    text = ''
    i = 0
    while i < len(text1) and text1[i] != ' ':
        i += 1
    i += 1
    while i < len(text1):
        text += text1[i]
        i += 1
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    else:
        name = find_name_music(text)
        print(name)
        if (name == '[]'):
            await message.answer('The bot did not find a song with this text :(')
        else:
            await message.answer(name)

@dp.message_handler(commands=['nextext'])
async def next_grandfather(message:types.Message):
    global x
    global text
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    else:
        name = find_name_music(text)
        if (name == '[]'):
            await message.answer('The bot did not find a song with this text :(')
        else:
            await message.answer(name)

@dp.message_handler(content_types=['text'])
async def cringe(message:types.Message):
    qwerty = '\U0001F631'
    await message.answer("It seems you've got the wrong team. "+qwerty+'.')

def delete_music(name):
    if os.path.isfile('C:/Users/plotc/PycharmProjects/AnkiApp/'+name):
        os.remove('C:/Users/plotc/PycharmProjects/AnkiApp/'+name)
        print('ok')
    else:
        print('bad')

def download_music (url, name):
    REQUEST_STATUS_CODE = 200
    req = requests.get(url=url, stream=True)
    if req.status_code == REQUEST_STATUS_CODE:
        with open(name, 'wb') as f:
            f.write(req.content)


def find_music(name):
    global g
    global m
    text2 = ''
    i = 0
    while i < len(name):
        if name[i] != ' ':
            text2 += name[i]
        else:
            text2 += '+'
        i += 1
    r = requests.get('https://rus.hitmotop.com/search?q='+text2)
    soup = BeautifulSoup(r.text, 'lxml')
    items = soup.find_all('li', class_='tracks__item track mustoggler')
    if g < len(items):
        el = items[g].find('a', class_='track__download-btn')
        el1 = str(el)
        return el1
    return '[]'

def find_name_music(name):
    global x
    r = requests.get('https://zaycev.net/search.html?query_search='+name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='fa9swr-6 eOPoOa')
    if x < len(items):
        itemName = items[x].find('div', class_='sc-1cisiq-5 fTOMam').text.strip()
        itemArtist = items[x].find('div', class_='sc-1cisiq-6 iHGhbl').text.strip()
        el = str(itemName)
        el += ' '
        el += str(itemArtist)
        x += 1
        return el
    return '[]'

def find_avtor(name):
    global g
    r = requests.get('https://rus.hitmotop.com/search?q='+name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='track__desc')
    if g < len(items):
        el = items[g].text
        el1 = str(el)
        return el1
    return '[]'

def find_name(name):
    global g
    r = requests.get('https://rus.hitmotop.com/search?q=' + name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='track__title')
    if g < len(items):
        el = items[g].text
        el1 = str(el)
        return (el1)
    return '[]'


def func(value):
    return ''.join(value.splitlines())

executor.start_polling(dp, skip_updates=True)













VERSION WITH AI....................................................................








import aiogram
import random
import requests
from bs4 import BeautifulSoup
import pandas as pd
from aiogram import Bot, Dispatcher, executor, types
import logging
import os
import openai

bot = Bot(token='Bot_token')
dp = Dispatcher(bot)
logging.basicConfig(level=logging.INFO)

openai.api_key = "API_KEY"

global s
global g
global x
global text
text = ''
x = 0
async def ai_find_song(description):
    try:
        response = openai.ChatCompletion.create(
            model="gpt-5-mini",
            messages=[
                {"role": "system", "content": "You're a music expert. Guess the song title and artist based on the description or part of the lyrics."},
                {"role": "user", "content": description}
            ],
            temperature=0.5
        )
        result = response.choices[0].message.content.strip()
        return result
    except Exception as e:
        print("AI search failed:", e)
        return None

@dp.message_handler(commands=['start', 'help'])
async def welcome(message: types.Message):
    text = '\U0001F62D'
    await message.reply(
        "Hi!\nDo you want to listen to music?\nThen you've come to the right place!!!\n"
        "Sending music will take time. We'll have to wait.\n"
        "For me to send you music, write a message like this:\n"
        "/music 'author of the composition' 'title of the song'.\n"
        "If the bot sent the wrong song that you were looking for, then enter the /next command.\n"
        "I can also determine the name of the song from the lyrics.\n"
        "To do this, you need to enter the command /text 'song lyrics'.\n"
        "If this is not the song you were looking for, then enter the /next command.\n"
        "I was created by @PlatoPutorano"
    )

@dp.message_handler(commands=['text'])
async def grandfather(message: types.Message):
    global x
    global text
    x = 0
    text1 = message.text
    text = ''
    i = 0
    while i < len(text1) and text1[i] != ' ':
        i += 1
    i += 1
    while i < len(text1):
        text += text1[i]
        i += 1
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    else:
        name = find_name_music(text)
        print(name)
        if (name == '[]'):
            ai_result = await ai_find_song(text)
            if ai_result:
                await message.answer(f"AI found something similar:\n{ai_result}")
            else:
                await message.answer('The bot couldnt find the song with these lyrics :(')
        else:
            await message.answer(name)

@dp.message_handler(commands=['nextext'])
async def next_grandfather(message: types.Message):
    global x
    global text
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    else:
        name = find_name_music(text)
        if (name == '[]'):
            ai_result = await ai_find_song(text)
            if ai_result:
                await message.answer(f"AI нашёл что-то похожее:\n{ai_result}")
            else:
                await message.answer('Бот не смог найти песню по этому тексту :(')
        else:
            await message.answer(name)

@dp.message_handler(commands=['music'])
async def music(message:types.Message):
    global text
    global g
    g = 0
    text = message.text
    text1 = ''
    i = 0
    while i < len(text) and text[i] != ' ':
        i += 1

    i += 1
    while i < len(text):
        text1 += text[i]
        i += 1
    i += 0
    url1 = (text1)
    print(url1)
    url = ''
    i = 52
    while i < len(url1) and url1[i] != '"':
        url += url1[i]
        i += 1
    text = find_name(text1)
    text2 = find_avtor(text1)
    text2 = func(text2)
    text1 = ""
    text = func(text)
    i = 0
    for i in range(len(text)):
        if text[i] != ' ':
            text1 = text1 + text[i]
    text1 = text1 + " "
    i = 0
    for i in range(len(text2)):
        if text2[i] != ' ':
            text1 = text1 + text2[i]
    text1 = func(text1)
    print(text1)
    if i >= len(url1):
        await message.answer('Whoops..... The bot did not find the song.')
    else:
        g += 1
        await message.answer('The bot sends the song.')
        download_music(url=url, name=text1)
        await bot.send_audio(message.from_user.id, audio=open(text1, 'rb'))
        delete_music(text1)


@dp.message_handler(commands=['next'])
async def next_music(message:types.Message):
    global text
    global g
    text1 = ''
    if text == '':
        await message.answer('There is not enough data. How to add data is written if you write the /help command.')
    i = 0
    while i < len(text) and text[i] != ' ':
        i += 1

    i += 1
    while i < len(text):
        text1 += text[i]
        i += 1
    i += 0
    url1 = find_music(text1)
    print(url1)
    url = ''
    i = 52
    while i < len(url1) and url1[i] != '"':
        url += url1[i]
        i += 1
    print(url)
    text = find_name(text1)
    text1 = ""
    text = func(text)
    i = 0
    for i in range(len(text)):
        if text[i] != ' ':
            text1 = text1 + text[i]
    text1 = text1 + " "
    text2 = find_avtor(text1)
    text2 = func(text2)
    i = 0
    for i in range(len(text2)):
        if text2[i] != ' ':
            text1 = text1 + text2[i]
    text1 = func(text1)
    print(text1)
    if i >= len(url1):
        await message.answer('Whoops..... The bot did not find the song.')
    else:
        await message.answer('The bot sends the song.')
        download_music(url=url, name=text1)
        await bot.send_audio(message.from_user.id, audio=open(text1, 'rb'))
        delete_music(text1)

def delete_music(name):
    if os.path.isfile('C:/Users/plotc/PycharmProjects/AnkiApp/'+name):
        os.remove('C:/Users/plotc/PycharmProjects/AnkiApp/'+name)
        print('ok')
    else:
        print('bad')

def download_music (url, name):
    REQUEST_STATUS_CODE = 200
    req = requests.get(url=url, stream=True)
    if req.status_code == REQUEST_STATUS_CODE:
        with open(name, 'wb') as f:
            f.write(req.content)

def find_music(name):
    global g
    text2 = ''
    i = 0
    while i < len(name):
        if name[i] != ' ':
            text2 += name[i]
        else:
            text2 += '+'
        i += 1
    r = requests.get('https://rus.hitmotop.com/search?q='+text2)
    soup = BeautifulSoup(r.text, 'lxml')
    items = soup.find_all('li', class_='tracks__item track mustoggler')
    if g < len(items):
        el = items[g].find('a', class_='track__download-btn')
        el1 = str(el)
        return el1
    return '[]'

def find_name_music(name):
    global x
    r = requests.get('https://zaycev.net/search.html?query_search='+name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='fa9swr-6 eOPoOa')
    if x < len(items):
        itemName = items[x].find('div', class_='sc-1cisiq-5 fTOMam').text.strip()
        itemArtist = items[x].find('div', class_='sc-1cisiq-6 iHGhbl').text.strip()
        el = str(itemName)
        el += ' '
        el += str(itemArtist)
        x += 1
        return el
    return '[]'

def find_avtor(name):
    global g
    r = requests.get('https://rus.hitmotop.com/search?q='+name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='track__desc')
    if g < len(items):
        el = items[g].text
        el1 = str(el)
        return el1
    return '[]'

def find_name(name):
    global g
    r = requests.get('https://rus.hitmotop.com/search?q=' + name)
    soup = BeautifulSoup(r.text, 'html.parser')
    items = soup.find_all('div', class_='track__title')
    if g < len(items):
        el = items[g].text
        el1 = str(el)
        return (el1)
    return '[]'

def func(value):
    return ''.join(value.splitlines())

executor.start_polling(dp, skip_updates=True)
